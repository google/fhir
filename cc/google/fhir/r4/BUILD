licenses(["notice"])

package(default_visibility = ["//visibility:public"])

cc_library(
    name = "profiles",
    srcs = [
        "profiles.cc",
    ],
    hdrs = ["profiles.h"],
    strip_include_prefix = "//cc/",
    deps = [
        ":operation_error_reporter",
        ":primitive_handler",
        "//cc/google/fhir:error_reporter",
        "//cc/google/fhir:profiles_lib",
        "//cc/google/fhir/status",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_cc_proto",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/status:statusor",
    ],
)

cc_test(
    name = "profiles_test",
    srcs = [
        "profiles_test.cc",
    ],
    data = [
        "//testdata/r4:examples",
        "//testdata/r4/profiles:testdata",
    ],
    deps = [
        ":profiles",
        "//cc/google/fhir:test_helper",
        "//cc/google/fhir/status",
        "//cc/google/fhir/status:statusor",
        "//cc/google/fhir/testutil:proto_matchers",
        "//proto/google/fhir/proto/r4:uscore_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:bundle_and_contained_resource_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:encounter_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:observation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:patient_cc_proto",
        "//testdata/r4/profiles:test_cc_proto",
        "@com_google_absl//absl/status:statusor",
        "@com_google_absl//absl/strings",
        "@com_google_googletest//:gtest_main",
    ],
)

cc_library(
    name = "codeable_concepts",
    srcs = ["codeable_concepts.cc"],
    hdrs = ["codeable_concepts.h"],
    strip_include_prefix = "//cc/",
    deps = [
        "//cc/google/fhir:annotations",
        "//cc/google/fhir:codes",
        "//cc/google/fhir:fhir_types",
        "//cc/google/fhir:proto_util",
        "//cc/google/fhir/status:statusor",
        "//proto/google/fhir/proto:annotations_cc_proto",
        "//proto/google/fhir/proto/r4/core:datatypes_cc_proto",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/status:statusor",
        "@com_google_absl//absl/types:optional",
        "@com_google_protobuf//:protobuf",
    ],
)

cc_test(
    name = "codeable_concepts_test",
    srcs = ["codeable_concepts_test.cc"],
    data = [
        "//testdata/r4/profiles:testdata",
    ],
    deps = [
        ":codeable_concepts",
        "//cc/google/fhir:test_helper",
        "//cc/google/fhir/testutil:proto_matchers",
        "//proto/google/fhir/proto/r4/core:datatypes_cc_proto",
        "//testdata/r4/profiles:test_cc_proto",
        "@com_google_absl//absl/status",
        "@com_google_googletest//:gtest_main",
    ],
)

cc_library(
    name = "primitive_handler",
    srcs = ["primitive_handler.cc"],
    hdrs = ["primitive_handler.h"],
    strip_include_prefix = "//cc/",
    deps = [
        ":codeable_concepts",
        "//cc/google/fhir:annotations",
        "//cc/google/fhir:codes",
        "//cc/google/fhir:extensions",
        "//cc/google/fhir:fhir_types",
        "//cc/google/fhir:primitive_handler",
        "//cc/google/fhir:primitive_wrapper",
        "//cc/google/fhir:proto_util",
        "//cc/google/fhir:util",
        "//cc/google/fhir/status",
        "//cc/google/fhir/status:statusor",
        "//proto/google/fhir/proto/r4:fhirproto_extensions_cc_proto",
        "//proto/google/fhir/proto/r4/core:datatypes_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:bundle_and_contained_resource_cc_proto",
        "@com_google_absl//absl/memory",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/status:statusor",
        "@com_google_absl//absl/strings",
        "@com_google_protobuf//:protobuf",
    ],
)

cc_test(
    name = "primitive_handler_test",
    srcs = ["primitive_handler_test.cc"],
    data = [
        "//testdata/r4:validation",
    ],
    deps = [
        ":json_format",
        ":primitive_handler",
        "//cc/google/fhir:annotations",
        "//cc/google/fhir:json_format",
        "//cc/google/fhir:test_helper",
        "//cc/google/fhir/testutil:proto_matchers",
        "//proto/google/fhir/proto/r4:fhirproto_extensions_cc_proto",
        "//proto/google/fhir/proto/r4/core:datatypes_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:binary_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:observation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:patient_cc_proto",
        "@com_google_absl//absl/status:statusor",
        "@com_google_absl//absl/strings",
        "@com_google_googletest//:gtest_main",
        "@com_google_protobuf//:protobuf",
    ],
)

cc_library(
    name = "json_format",
    srcs = ["json_format.cc"],
    hdrs = ["json_format.h"],
    strip_include_prefix = "//cc/",
    deps = [
        ":primitive_handler",
        "//cc/google/fhir:error_reporter",
        "//cc/google/fhir:json_format",
        "//cc/google/fhir:json_format_results",
        "//cc/google/fhir/json:fhir_json",
        "//cc/google/fhir/status",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/status:statusor",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/time",
    ],
)

cc_test(
    name = "json_format_test",
    size = "large",
    srcs = ["json_format_test.cc"],
    data = [
        "//spec:r4_examples",
        "//testdata/jsonformat",
        "//testdata/r4:bigquery",
        "//testdata/r4:examples",
        "//testdata/r4/profiles:testdata",
    ],
    shard_count = 10,
    deps = [
        ":json_format",
        ":operation_error_reporter",
        ":primitive_handler",
        ":profiles",
        ":resource_validation",
        "//cc/google/fhir:error_reporter",
        "//cc/google/fhir:proto_util",
        "//cc/google/fhir/json:fhir_json",
        "//cc/google/fhir/json:json_sax_handler",
        "//cc/google/fhir/json:test_matchers",
        "//cc/google/fhir/status",
        "//cc/google/fhir/status:statusor",
        "//cc/google/fhir/testutil:generator",
        "//cc/google/fhir/testutil:proto_matchers",
        "//proto/google/fhir/proto:annotations_cc_proto",
        "//proto/google/fhir/proto/r4/core:codes_cc_proto",
        "//proto/google/fhir/proto/r4/core:datatypes_cc_proto",
        "//proto/google/fhir/proto/r4/core/profiles:observation_genetics_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:account_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:activity_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:adverse_event_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:allergy_intolerance_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:appointment_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:appointment_response_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:audit_event_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:basic_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:binary_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:biologically_derived_product_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:body_structure_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:bundle_and_contained_resource_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:capability_statement_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:care_plan_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:care_team_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:catalog_entry_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:charge_item_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:charge_item_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:claim_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:claim_response_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:clinical_impression_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:code_system_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:communication_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:communication_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:compartment_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:composition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:concept_map_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:condition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:consent_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:contract_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:coverage_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:coverage_eligibility_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:coverage_eligibility_response_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:detected_issue_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:device_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:device_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:device_metric_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:device_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:device_use_statement_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:diagnostic_report_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:document_manifest_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:document_reference_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:effect_evidence_synthesis_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:encounter_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:endpoint_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:enrollment_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:enrollment_response_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:episode_of_care_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:event_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:evidence_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:evidence_variable_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:example_scenario_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:explanation_of_benefit_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:family_member_history_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:flag_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:goal_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:graph_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:group_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:guidance_response_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:healthcare_service_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:imaging_study_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:immunization_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:immunization_evaluation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:immunization_recommendation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:implementation_guide_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:insurance_plan_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:invoice_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:library_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:linkage_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:list_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:location_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:measure_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:measure_report_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:media_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medication_administration_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medication_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medication_dispense_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medication_knowledge_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medication_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medication_statement_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_authorization_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_contraindication_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_indication_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_ingredient_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_interaction_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_manufactured_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_packaged_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_pharmaceutical_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_undesirable_effect_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:message_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:message_header_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:metadata_resource_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:molecular_sequence_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:naming_system_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:nutrition_order_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:observation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:observation_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:operation_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:organization_affiliation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:organization_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:parameters_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:patient_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:payment_notice_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:payment_reconciliation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:person_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:plan_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:practitioner_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:practitioner_role_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:procedure_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:provenance_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:questionnaire_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:questionnaire_response_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:related_person_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:request_group_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:research_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:research_element_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:research_study_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:research_subject_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:risk_assessment_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:risk_evidence_synthesis_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:schedule_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:search_parameter_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:service_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:slot_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:specimen_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:specimen_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:structure_definition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:structure_map_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:subscription_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:substance_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:substance_nucleic_acid_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:substance_polymer_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:substance_protein_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:substance_reference_information_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:substance_source_material_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:substance_specification_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:supply_delivery_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:supply_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:task_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:terminology_capabilities_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:test_report_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:test_script_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:value_set_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:verification_result_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:vision_prescription_cc_proto",
        "//testdata/r4/profiles:test_cc_proto",
        "@com_google_absl//absl/log:check",
        "@com_google_absl//absl/status:statusor",
        "@com_google_absl//absl/strings",
        "@com_google_googletest//:gtest_main",
        "@com_google_protobuf//:protobuf",
    ],
)

cc_library(
    name = "resource_validation",
    srcs = ["resource_validation.cc"],
    hdrs = ["resource_validation.h"],
    strip_include_prefix = "//cc/",
    deps = [
        ":operation_error_reporter",
        ":primitive_handler",
        ":profiles",
        ":validation_error_handler",
        "//cc/google/fhir:error_reporter",
        "//cc/google/fhir:references",
        "//cc/google/fhir:resource_validation",
        "//cc/google/fhir:util",
        "//cc/google/fhir/fhir_path:fhir_path_validation",
        "//cc/google/fhir/status:statusor",
        "//proto/google/fhir/proto/r4:fhirproto_cc_proto",
        "//proto/google/fhir/proto/r4/core:datatypes_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_cc_proto",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/status:statusor",
        "@com_google_protobuf//:protobuf",
    ],
)

cc_library(
    name = "operation_error_reporter",
    srcs = ["operation_error_reporter.cc"],
    hdrs = ["operation_error_reporter.h"],
    strip_include_prefix = "//cc/",
    deps = [
        "//cc/google/fhir:operation_error_reporter",
        "//proto/google/fhir/proto/r4/core:codes_cc_proto",
        "//proto/google/fhir/proto/r4/core:datatypes_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_cc_proto",
        "@com_google_absl//absl/strings:str_format",
    ],
)

cc_library(
    name = "validation_error_handler",
    hdrs = ["validation_error_handler.h"],
    strip_include_prefix = "//cc/",
    deps = [
        "//cc/google/fhir:operation_error_reporter",
        "//proto/google/fhir/proto/r4:fhirproto_cc_proto",
        "//proto/google/fhir/proto/r4/core:codes_cc_proto",
    ],
)

cc_test(
    name = "resource_validation_test",
    srcs = ["resource_validation_test.cc"],
    data = [
        "//testdata/r4:validation",
    ],
    deps = [
        ":operation_error_reporter",
        ":resource_validation",
        "//cc/google/fhir:references",
        "//cc/google/fhir:test_helper",
        "//cc/google/fhir/status",
        "//cc/google/fhir/status:statusor",
        "//cc/google/fhir/testutil:proto_matchers",
        "//proto/google/fhir/proto/r4:fhirproto_cc_proto",
        "//proto/google/fhir/proto/r4:fhirproto_extensions_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:bundle_and_contained_resource_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:composition_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:coverage_eligibility_request_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:encounter_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:observation_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_cc_proto",
        "//proto/google/fhir/proto/r4/core/resources:practitioner_role_cc_proto",
        "//testdata/r4/profiles:test_cc_proto",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_googletest//:gtest_main",
        "@com_google_protobuf//:protobuf",
    ],
)

cc_test(
    name = "operation_error_reporter_test",
    srcs = ["operation_error_reporter_test.cc"],
    deps = [
        ":operation_error_reporter",
        "//cc/google/fhir/status",
        "//cc/google/fhir/testutil:proto_matchers",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_cc_proto",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_googletest//:gtest_main",
        "@com_google_protobuf//:protobuf",
    ],
)
