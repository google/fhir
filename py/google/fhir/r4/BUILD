load(
    "@rules_python//python:python.bzl",
    "py_library",
    "py_test",
)
load("@fhir_bazel_pip_dependencies//:requirements.bzl", "requirement")

package(
    default_visibility = [
        "//visibility:public",
    ],
)

licenses(["notice"])

py_library(
    name = "json_format",
    srcs = [
        "__init__.py",
        "json_format.py",
    ],
    srcs_version = "PY3",
    deps = [
        ":primitive_handler",
        "//py",
        "//py/google/fhir:primitive_time_utils",
        "//py/google/fhir:resource_validation",
        "//py/google/fhir/json_format",
        "@com_google_protobuf//:protobuf_python",
    ],
)

py_library(
    name = "primitive_handler",
    srcs = [
        "__init__.py",
        "primitive_handler.py",
    ],
    srcs_version = "PY3",
    deps = [
        "//py",
        "//proto/google/fhir/proto/r4:fhirproto_extensions_py_pb2",
        "//proto/google/fhir/proto/r4/core:datatypes_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:bundle_and_contained_resource_py_pb2",
        "//py/google/fhir:primitive_handler",
        "//py/google/fhir:primitive_time_utils",
        "//py/google/fhir/json_format/wrappers:base64_binary",
        "//py/google/fhir/json_format/wrappers:date",
        "//py/google/fhir/json_format/wrappers:date_time",
        "//py/google/fhir/json_format/wrappers:decimal",
        "//py/google/fhir/json_format/wrappers:instant",
        "//py/google/fhir/json_format/wrappers:primitive_wrappers",
        "//py/google/fhir/json_format/wrappers:time",
        "//py/google/fhir/utils:annotation_utils",
        "//py/google/fhir/utils:fhir_types",
        "@com_google_protobuf//:protobuf_python",
    ],
)

py_test(
    name = "json_format_test",
    size = "large",
    srcs = [
        "json_format_test.py",
    ],
    data = [
        "//spec:r4",
        "//spec:r4_examples",
        "//testdata/r4:bigquery",
        "//testdata/r4:examples",
        "//testdata/r4:validation",
    ],
    legacy_create_init = 0,
    python_version = "PY3",
    shard_count = 16,
    deps = [
        "@com_google_protobuf//:protobuf_python",
        "//py",
        "//proto/google/fhir/proto/r4/core/resources:code_system_py_pb2",
        "//proto/google/fhir/proto/r4/core:datatypes_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:account_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:activity_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:adverse_event_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:allergy_intolerance_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:appointment_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:appointment_response_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:audit_event_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:basic_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:binary_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:biologically_derived_product_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:body_structure_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:bundle_and_contained_resource_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:capability_statement_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:care_plan_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:care_team_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:catalog_entry_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:charge_item_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:charge_item_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:claim_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:claim_response_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:clinical_impression_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:communication_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:communication_request_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:compartment_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:composition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:condition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:consent_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:contract_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:coverage_eligibility_request_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:coverage_eligibility_response_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:coverage_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:detected_issue_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:device_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:device_metric_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:device_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:device_request_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:device_use_statement_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:diagnostic_report_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:document_manifest_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:document_reference_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:effect_evidence_synthesis_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:encounter_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:endpoint_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:enrollment_request_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:enrollment_response_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:episode_of_care_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:event_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:evidence_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:evidence_variable_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:example_scenario_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:explanation_of_benefit_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:family_member_history_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:flag_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:goal_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:graph_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:group_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:guidance_response_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:healthcare_service_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:imaging_study_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:immunization_evaluation_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:immunization_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:immunization_recommendation_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:implementation_guide_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:insurance_plan_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:invoice_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:library_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:linkage_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:list_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:location_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:measure_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:measure_report_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:media_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medication_administration_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medication_dispense_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medication_knowledge_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medication_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medication_request_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medication_statement_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_authorization_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_contraindication_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_indication_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_ingredient_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_interaction_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_manufactured_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_packaged_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_pharmaceutical_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:medicinal_product_undesirable_effect_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:message_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:message_header_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:molecular_sequence_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:naming_system_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:nutrition_order_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:observation_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:observation_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:operation_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:operation_outcome_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:organization_affiliation_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:organization_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:parameters_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:patient_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:payment_notice_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:payment_reconciliation_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:person_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:plan_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:practitioner_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:practitioner_role_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:procedure_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:provenance_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:questionnaire_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:questionnaire_response_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:related_person_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:request_group_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:research_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:research_element_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:research_study_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:research_subject_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:risk_assessment_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:risk_evidence_synthesis_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:schedule_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:service_request_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:slot_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:specimen_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:specimen_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:structure_definition_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:structure_map_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:subscription_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:substance_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:substance_specification_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:supply_delivery_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:supply_request_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:task_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:terminology_capabilities_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:test_report_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:test_script_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:verification_result_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:vision_prescription_py_pb2",
        "//py/google/fhir:fhir_errors",
        "//py/google/fhir/json_format:json_format_test",
        ":json_format",
        "//py/google/fhir/testing:testdata_utils",
        "//py/google/fhir/utils:proto_utils",
        requirement("absl-py"),
        requirement("six"),
    ],
)

py_test(
    name = "codes_test",
    size = "small",
    srcs = [
        "codes_test.py",
    ],
    data = [
        "//testdata/r4/codes:testdata",
    ],
    legacy_create_init = 0,
    python_version = "PY3",
    deps = [
        "@com_google_protobuf//:protobuf_python",
        "//py",
        "//proto/google/fhir/proto/r4:uscore_py_pb2",
        "//proto/google/fhir/proto/r4/core:codes_py_pb2",
        "//proto/google/fhir/proto/r4/core:datatypes_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:patient_py_pb2",
        "//py/google/fhir:codes",
        "//py/google/fhir/testing:testdata_utils",
        "//py/google/fhir:fhir_errors",
        requirement("absl-py"),
        requirement("six"),
    ],
)

py_test(
    name = "extensions_test",
    srcs = [
        "extensions_test.py",
    ],
    data = [
        "//testdata/r4:extensions",
    ],
    legacy_create_init = 0,
    python_version = "PY3",
    deps = [
        "@com_google_protobuf//:protobuf_python",
        "//py",
        "//proto/google/fhir/proto/r4:fhirproto_extensions_py_pb2",
        "//proto/google/fhir/proto/r4:ml_extensions_py_pb2",
        "//proto/google/fhir/proto/r4/core:datatypes_py_pb2",
        "//proto/google/fhir/proto/r4/core:extensions_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:patient_py_pb2",
        "//py/google/fhir:extensions",
        "//py/google/fhir:extensions_test",
        "//testdata/r4/profiles:test_extensions_py_pb2",
        requirement("absl-py"),
        requirement("six"),
    ],
)

py_test(
    name = "primitive_handler_test",
    srcs = [
        "primitive_handler_test.py",
    ],
    data = [
        "//testdata/r4:validation",
    ],
    legacy_create_init = 0,
    python_version = "PY3",
    deps = [
        "//py",
        "//py/google/fhir:primitive_handler_test",
        "//py/google/fhir/r4:primitive_handler",
        requirement("absl-py"),
        requirement("six"),
    ],
)

py_test(
    name = "references_test",
    srcs = [
        "references_test.py",
    ],
    data = [],
    legacy_create_init = 0,
    python_version = "PY3",
    deps = [
        "//py",
        "//proto/google/fhir/proto/r4/core:datatypes_py_pb2",
        "//py/google/fhir:references",
        "//py/google/fhir/utils:proto_utils",
        requirement("absl-py"),
        requirement("six"),
    ],
)

py_library(
    name = "resource_validation",
    srcs = [
        "__init__.py",
        "resource_validation.py",
    ],
    srcs_version = "PY3",
    deps = [
        ":primitive_handler",
        "//py",
        "//py/google/fhir:resource_validation",
        "@com_google_protobuf//:protobuf_python",
    ],
)

py_test(
    name = "resource_validation_test",
    srcs = [
        "resource_validation_test.py",
    ],
    data = [
        "//testdata/r4:validation",
    ],
    legacy_create_init = 0,
    python_version = "PY3",
    deps = [
        ":resource_validation",
        "@com_google_protobuf//:protobuf_python",
        "//py",
        "//proto/google/fhir/proto/r4/core/resources:bundle_and_contained_resource_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:encounter_py_pb2",
        "//proto/google/fhir/proto/r4/core/resources:observation_py_pb2",
        "//py/google/fhir:fhir_errors",
        "//py/google/fhir/testing:testdata_utils",
        requirement("absl-py"),
        requirement("six"),
    ],
)
